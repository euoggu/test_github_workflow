name: pinpoint

on:
  workflow_dispatch:

jobs:
  pull-and-save:
    runs-on: ubuntu-latest
    
    steps:
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Pull pinpoint-hbase
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-hbase:2.5.4

      - name: Pull pinpoint-mysql
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-mysql:2.5.4

      - name: Pull pinpoint-web
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-web:2.5.4

      - name: Pull pinpoint-collector
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-collector:2.5.4

      - name: Pull pinpoint-quickstart
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-quickstart

      - name: Pull pinpoint-batch
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-batch:2.5.4

      - name: Pull pinpoint-agent
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-agent:2.5.4

      - name: Pull zookeeper
        run: docker pull --platform linux/arm64 zookeeper:3.4.13

      - name: Pull pinpoint-flink
        run: docker pull --platform linux/arm64 pinpointdocker/pinpoint-flink:2.5.4

      - name: Save pinpoint-hbase
        run: docker save -o pinpoint-hbase-2.5.4-arm64.tar pinpointdocker/pinpoint-hbase:2.5.4

      - name: Save pinpoint-mysql
        run: docker save -o pinpoint-mysql-2.5.4-arm64.tar pinpointdocker/pinpoint-mysql:2.5.4

      - name: Save pinpoint-web
        run: docker save -o pinpoint-web-2.5.4-arm64.tar pinpointdocker/pinpoint-web:2.5.4

      - name: Save pinpoint-collector
        run: docker save -o pinpoint-collector-2.5.4-arm64.tar pinpointdocker/pinpoint-collector:2.5.4

      - name: Save pinpoint-quickstart
        run: docker save -o pinpoint-quickstart-arm64.tar pinpointdocker/pinpoint-quickstart

      - name: Save pinpoint-batch
        run: docker save -o pinpoint-batch-2.5.4-arm64.tar pinpointdocker/pinpoint-batch:2.5.4

      - name: Save pinpoint-agent
        run: docker save -o pinpoint-agent-2.5.4-arm64.tar pinpointdocker/pinpoint-agent:2.5.4

      - name: Save zookeeper
        run: docker save -o zookeeper-3.4.13-arm64.tar zookeeper:3.4.13

      - name: Save pinpoint-flink
        run: docker save -o pinpoint-flink-2.5.4-arm64.tar pinpointdocker/pinpoint-flink:2.5.4

      - name: Show file sizes
        run: ls -lh *.tar

      - name: Upload pinpoint-hbase
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-hbase-2.5.4-arm64
          path: pinpoint-hbase-2.5.4-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-mysql
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-mysql-2.5.4-arm64
          path: pinpoint-mysql-2.5.4-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-web
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-web-2.5.4-arm64
          path: pinpoint-web-2.5.4-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-collector
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-collector-2.5.4-arm64
          path: pinpoint-collector-2.5.4-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-quickstart
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-quickstart-arm64
          path: pinpoint-quickstart-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-batch
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-batch-2.5.4-arm64
          path: pinpoint-batch-2.5.4-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-agent
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-agent-2.5.4-arm64
          path: pinpoint-agent-2.5.4-arm64.tar
          retention-days: 7

      - name: Upload zookeeper
        uses: actions/upload-artifact@v4
        with:
          name: zookeeper-3.4.13-arm64
          path: zookeeper-3.4.13-arm64.tar
          retention-days: 7

      - name: Upload pinpoint-flink
        uses: actions/upload-artifact@v4
        with:
          name: pinpoint-flink-2.5.4-arm64
          path: pinpoint-flink-2.5.4-arm64.tar
          retention-days: 7
